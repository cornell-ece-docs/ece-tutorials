<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="ECE Course Staff">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>ECE2400 Section 3: C Build and Test Frameworks - ECE Common Course Tutorials</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/docco.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">ECE Common Course Tutorials</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Tutorials</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../tut0-ecelinux/" class="dropdown-item">ECE Linux Server Remote Access</a>
</li>
                                    
<li>
    <a href="../tut1-linux-cli/" class="dropdown-item">Linux Command Line Basics</a>
</li>
                                    
<li>
    <a href="../tut2-git/" class="dropdown-item">Using Git</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Guides</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../doc0-coding-style/" class="dropdown-item">ECE C/C++ Coding Conventions</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#ece2400-section-3-c-build-and-test-frameworks" class="nav-link">ECE2400 Section 3: C Build and Test Frameworks</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#1-logging-into-ecelinux-with-vs-code" class="nav-link">1. Logging Into ecelinux with VS Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2-using-makefiles-to-compile-c-programs" class="nav-link">2. Using Makefiles to Compile C Programs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#3-using-cmake-to-generate-makefiles-for-compiling-c-programs" class="nav-link">3. Using CMake to Generate Makefiles for Compiling C Programs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ece2400-section-3-c-build-and-test-frameworks">ECE2400 Section 3: C Build and Test Frameworks</h1>
<p>In the previous discussion section, you learned how to explicitly compile
and run C programs from the command line. You learned how to use the GNU
C Compiler (<code>gcc</code>) to compile both a single-file program, as well as a multi-file program that calculated the square
of an integer. You probably noticed that it can be tedious to have to
carefully enter the correct commands on the command line. 
In this discussion section, we will more closely exam the <em>GNU Make build framework</em>
and <em>CMake build framework</em> to automate the C build process.</p>
<h2 id="1-logging-into-ecelinux-with-vs-code">1. Logging Into <code>ecelinux</code> with VS Code</h2>
<p>Once again, we will be using VS Code to log into the ecelinux servers:</p>
<ul>
<li>Start VS Code</li>
<li>Use <em>View &gt; Command Palette</em> to execute <em>Remote-SSH: Connect Current Window to Host...</em></li>
<li>Enter <code>netid@ecelinux.ece.cornell.edu</code></li>
<li>Use <em>View &gt; Explorer</em> to open folder on <code>ecelinux</code></li>
<li>Use <em>View &gt; Terminal</em> to open terminal on <code>ecelinux</code></li>
</ul>
<p>Now clone the <a href="https://github.com/cornell-ece2400/ece2400-sec02-2025">GitHub repo</a> using the following commands:</p>
<pre><code class="language-bash">$ git clone --branch sec03 git@github.com:cornell-ece2400/ece2400-sec02-2025 ece2400-sec03
$ cd ece2400-sec03
$ tree
</code></pre>
<p>The directory includes the following files:</p>
<ul>
<li><code>avg-main.c</code>: source and main for single-file <code>avg</code> program</li>
<li><code>square.h</code>: header file for the <code>square</code> function</li>
<li><code>square.c</code>: source file for the <code>square</code> function</li>
<li><code>square-adhoc.c</code> : test driver for <code>square</code> function</li>
</ul>
<h2 id="2-using-makefiles-to-compile-c-programs">2. Using Makefiles to Compile C Programs</h2>
<p>Let's remind ourselves how to explicitly compile and run a single-file C
program on the command line:</p>
<pre><code class="language-bash">$ gcc -Wall -o avg-main src/avg-main.c
$ ./avg-main
</code></pre>
<p>Let's now remove the binary so we are back to a clean directory:</p>
<pre><code class="language-bash">$ rm -r avg-main
</code></pre>
<p>We will start by using a new tool called GNU Make which was specifically
designed to help automate the process of building C programs. The key to
using <code>make</code> is developing a <code>Makefile</code>. A <code>Makefile</code> is a plain text
file which contains a list of <em>rules</em> which together specify how to
execute commands to accomplish some task. Each rule has the following
syntax:</p>
<pre><code>    target : prerequisite0 prerequisite1 prerequisite2
    &lt;TAB&gt;command
</code></pre>
<p>A rule show specify how to generate the target file using the list of
prerequisite files combined with a shell command. <code>make</code> is smart enough to
know it should re-make the target if any of the prerequisites change, and
it also knows that if one of the prerequisites does not exist, then it
should try to build it first. This process occurs recursively. It
is very important to note that <code>make</code> requires commands in a rule to
start with a real TAB character. <strong>So you should not type the letters
<code>&lt;TAB&gt;</code>, but you should instead press the TAB key and verify that it has
inserted a real TAB character (i.e., if you move the left/right arrows
the cursor should jump back and forth across the TAB).</strong> This is the only
time in the course where you should use a real TAB character as opposed
to spaces.</p>
<p>Let's create a simple <code>Makefile</code> to compile a single-file C program. Use
VS Code to create a file named <code>Makefile</code> with the following content:</p>
<pre><code class="language-makefile">avg-main: src/avg-main.c
&lt;TAB&gt;gcc -Wall -o avg-main $^

clean:
&lt;TAB&gt;rm -rf avg-main
</code></pre>
<p>In this case <code>$^</code> refers to <code>src/avg-main.c</code>.
See <a href="https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html">GNU Automatic Variables</a> for more info.
We can use the newly created <code>Makefile</code> like this:</p>
<pre><code class="language-bash">$ make avg-main
$ ./avg-main
</code></pre>
<p><code>make</code> will by default use the <code>Makefile</code> in the current directory.
<code>make</code> takes a command line argument specifying what you want "make". <code>make</code> will look
at all of the rules in the <code>Makefile</code> to find a rule that specifies how
to make the <code>avg-main</code> executable. It will then check to make sure the
prerequisites exist and that they are up-to-date. If that condition is met, it will run
the command specified in the rule for <code>avg-main</code>. In this case, that
command is <code>gcc</code>. <code>make</code> will output to the terminal every command it
runs, so you should see it output the command line which uses <code>gcc</code> to
generate the <code>avg-main</code> executable.</p>
<p>Try running <code>make</code> again:</p>
<pre><code class="language-bash">$ make avg-main
$ ./avg-main
</code></pre>
<p><code>make</code> detects that the prerequisite (i.e., <code>src/avg-main.c</code>) has not
changed and so it does not recompile the executable. Now let's try making
a change in the <code>avg-main.c</code> source file. Modify the <code>printf</code> statement
as follows:</p>
<pre><code class="language-c">printf(&quot;avg( %d, %d ) == %d\n&quot;, a, b, c );
</code></pre>
<p>You can recompile and re-execute the program like this:</p>
<pre><code class="language-bash">$ make avg-main
$ ./avg-main
</code></pre>
<p>In this case, <code>make</code> detects that the prerequisite has changed, and hence
recompile the executable. The ability to automatically
track dependencies and recompile only what is necessary is the key benefit
of using a tool like GNU Make. Makefiles can also include targets which
are not actually files. Our example <code>Makefile</code> includes a <code>clean</code> target
which will delete any generated executables. Let's clean up our directory
like this:</p>
<pre><code class="language-bash">$ ls
$ make clean
$ ls
</code></pre>
<h2 id="3-using-cmake-to-generate-makefiles-for-compiling-c-programs">3. Using CMake to Generate Makefiles for Compiling C Programs</h2>
<p>While using <code>make</code> can help automate the build process, the corresponding
Makefiles can grow to be incredibly complicated. Creating and
maintaining these Makefiles can involve significant effort. It can be
particularly challenging to ensure all of the dependencies between the
various source and header files are always correctly captured in the
<code>Makefile</code>. </p>
<p>New tools have been developed to help <em>automate</em> the process of managing
Makefiles (which in turn <em>automate</em> the build process). Automation is
the key to effective software development methodologies. In this course,
we will be using CMake as a key step in our build framework. CMake takes
as input a simple <code>CMakeLists.txt</code> file and <em>generates</em> a more sophisticated
<code>Makefile</code> to use.</p>
<p>Before getting started let's remove any files we have generated and also
remove the <code>Makefile</code> we developed in the previous section.</p>
<pre><code class="language-bash">$ make clean
$ rm -f Makefile
</code></pre>
<p>Let's inspect the provided <code>CMakeLists.txt</code> that can be used to generate a
<code>Makefile</code> which will in turn be used to compile a single-file C program:</p>
<pre><code class="language-bash">$ cat CMakeLists.txt

cmake_minimum_required(VERSION 3.1)
project(sec02 C)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

include_directories(include)
add_subdirectory(src)
</code></pre>
<p>Line 1 specifies the CMake version we are assuming, and line 2 specifies
that we will be using CMake with a C project called <code>sec02</code>.
Line 3 states that we will be generating the database file, so that <code>clangd</code> can work.
The last two lines tell CMake where our code and header files live (<code>src/</code> and <code>include/</code>, respectively).</p>
<p>Notice, that there is another required <code>CMakeLists.txt</code> inside <code>src/</code> with more information about which source files to use:</p>
<pre><code class="language-bash">$ cat src/CMakeLists.txt

add_library(sec02-lib 
    square.c
)

add_executable(square-adhoc square-adhoc.c)
target_link_libraries(square-adhoc PUBLIC
  sec02-lib
)

add_executable(avg-main avg-main.c)
</code></pre>
<p>Now, let's use CMake to generate a GNU Makefile.</p>
<pre><code class="language-bash">$ cmake .
$ ls
$ less Makefile
</code></pre>
<p><strong>NOTE: THERE IS A DOT AFTER <code>cmake</code>!</strong> The <code>cmake</code> command will by default
use the <code>CMakeLists.txt</code> in the directory given as a command line
argument. CMake takes care of figuring out what C compilers are available
and then generating the <code>Makefile</code> appropriately. You can see that CMake
has automatically generated a pretty sophisticated <code>Makefile</code>. Let's go
ahead and use this <code>Makefile</code> to build <code>avg-main</code>.</p>
<pre><code class="language-bash">$ make avg-main
$ ./avg-main
</code></pre>
<p>CMake will automatically create some useful targets like <code>clean</code>.</p>
<pre><code class="language-bash">$ make clean
</code></pre>
<p>With some practice, writing a <code>CMakeLists.txt</code> is simpler than writing a <code>Makefile</code>,
especially when we start working with a large codebase.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2024 Christopher Batten, ECE Course Staff</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
